<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPL Data Pipeline Demo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .section { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        .player-list { max-height: 300px; overflow-y: auto; }
        .player-item { padding: 5px; border-bottom: 1px solid #eee; cursor: pointer; }
        .player-item:hover { background-color: #f5f5f5; }
        .selected { background-color: #e3f2fd; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .data-info { background: #f0f8ff; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .position-tabs { display: flex; margin-bottom: 10px; }
        .tab { padding: 8px 16px; background: #f0f0f0; border: 1px solid #ddd; cursor: pointer; margin-right: 5px; }
        .tab.active { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <h1>ğŸš€ FPL Data Pipeline Demo</h1>
    <p><strong>This demo shows how forms can consume fresh FPL data automatically updated from the official API.</strong></p>
    
    <div class="data-info">
        <h3>ğŸ“Š Data Status</h3>
        <div id="dataStatus">Loading data metadata...</div>
        <button onclick="refreshData()">ğŸ”„ Refresh Data</button>
    </div>

    <div class="container">
        <div class="section">
            <h3>ğŸ‘¥ Player Selection</h3>
            <div class="position-tabs">
                <div class="tab active" onclick="showPosition('goalkeepers')">GKP</div>
                <div class="tab" onclick="showPosition('defenders')">DEF</div>
                <div class="tab" onclick="showPosition('midfielders')">MID</div>
                <div class="tab" onclick="showPosition('forwards')">FWD</div>
            </div>
            <div id="playerList" class="player-list">
                Select a position to see players...
            </div>
        </div>

        <div class="section">
            <h3>âš½ Current Gameweek Fixtures</h3>
            <div id="fixturesList">Loading fixtures...</div>
        </div>
    </div>

    <div class="section" style="margin-top: 20px;">
        <h3>ğŸ¯ Top Performers</h3>
        <div class="position-tabs">
            <div class="tab active" onclick="showTopPerformers('top_scorers')">Top Scorers</div>
            <div class="tab" onclick="showTopPerformers('best_value')">Best Value</div>
            <div class="tab" onclick="showTopPerformers('most_selected')">Most Selected</div>
            <div class="tab" onclick="showTopPerformers('in_form')">In Form</div>
        </div>
        <div id="performersList" class="player-list">Loading top performers...</div>
    </div>

    <script>
        // Global data storage
        let fplData = {};
        let currentPosition = 'goalkeepers';
        let currentPerformers = 'top_scorers';

        // Initialize the demo
        async function initDemo() {
            try {
                await loadDataMetadata();
                await loadCurrentFixtures();
                await showPosition('goalkeepers');
                await showTopPerformers('top_scorers');
            } catch (error) {
                console.error('Error initializing demo:', error);
            }
        }

        // Load metadata to show data freshness
        async function loadDataMetadata() {
            try {
                const response = await fetch('data/exports/data_metadata.json');
                const metadata = await response.json();
                
                document.getElementById('dataStatus').innerHTML = `
                    <strong>âœ… Data is fresh and ready!</strong><br>
                    ğŸ“… Last Updated: ${metadata.last_updated}<br>
                    ğŸ“Š Players: ${metadata.total_players} | Teams: ${metadata.total_teams} | Fixtures: ${metadata.total_fixtures}<br>
                    ğŸ¯ Current Gameweek: ${metadata.current_gameweek}<br>
                    ğŸ’° Price Range: Â£${metadata.price_range.min}m - Â£${metadata.price_range.max}m<br>
                    ğŸ”— Data Source: ${metadata.data_source}
                `;
                
                fplData.metadata = metadata;
            } catch (error) {
                document.getElementById('dataStatus').innerHTML = `
                    <strong>âŒ Error loading data</strong><br>
                    Make sure you've run: <code>python fpl_predictor.py export-data</code>
                `;
            }
        }

        // Load current gameweek fixtures
        async function loadCurrentFixtures() {
            try {
                const response = await fetch('data/exports/current_gameweek_fixtures.json');
                const fixtures = await response.json();
                
                let fixturesHtml = fixtures.map(fixture => `
                    <div class="player-item">
                        <strong>${fixture.home_team_name} vs ${fixture.away_team_name}</strong><br>
                        <small>Difficulty: ${fixture.home_difficulty_label} vs ${fixture.away_difficulty_label}</small><br>
                        <small>Kickoff: ${new Date(fixture.kickoff_time).toLocaleString()}</small>
                    </div>
                `).join('');
                
                document.getElementById('fixturesList').innerHTML = fixturesHtml || 'No fixtures found';
                fplData.fixtures = fixtures;
            } catch (error) {
                document.getElementById('fixturesList').innerHTML = 'Error loading fixtures';
            }
        }

        // Show players by position
        async function showPosition(position) {
            try {
                // Update active tab
                document.querySelectorAll('.position-tabs .tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');

                const response = await fetch(`data/exports/${position}.json`);
                const players = await response.json();
                
                let playersHtml = players.slice(0, 20).map(player => `
                    <div class="player-item" onclick="selectPlayer('${player.id}')">
                        <strong>${player.first_name} ${player.second_name}</strong> (${player.team_short_name})<br>
                        <small>Â£${player.price_millions}m | ${player.total_points} pts | Form: ${player.form}</small>
                    </div>
                `).join('');
                
                document.getElementById('playerList').innerHTML = playersHtml;
                fplData[position] = players;
                currentPosition = position;
            } catch (error) {
                document.getElementById('playerList').innerHTML = 'Error loading players';
            }
        }

        // Show top performers
        async function showTopPerformers(category) {
            try {
                // Update active tab
                document.querySelectorAll('.section:last-child .position-tabs .tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');

                const response = await fetch(`data/exports/${category}.json`);
                const performers = await response.json();
                
                let performersHtml = performers.slice(0, 15).map(player => `
                    <div class="player-item">
                        <strong>${player.first_name} ${player.second_name}</strong> (${player.team_short_name}) - ${player.position_name}<br>
                        <small>Â£${player.price_millions}m | ${player.total_points} pts | ${player.selected_by_percent}% selected</small>
                    </div>
                `).join('');
                
                document.getElementById('performersList').innerHTML = performersHtml;
                fplData[category] = performers;
                currentPerformers = category;
            } catch (error) {
                document.getElementById('performersList').innerHTML = 'Error loading performers';
            }
        }

        // Player selection handler
        function selectPlayer(playerId) {
            document.querySelectorAll('#playerList .player-item').forEach(item => item.classList.remove('selected'));
            event.target.classList.add('selected');
            
            const player = fplData[currentPosition].find(p => p.id == playerId);
            if (player) {
                alert(`Selected: ${player.first_name} ${player.second_name} (Â£${player.price_millions}m)`);
            }
        }

        // Refresh data (in real implementation, this would trigger data update)
        async function refreshData() {
            document.getElementById('dataStatus').innerHTML = 'Refreshing data...';
            
            // Simulate data refresh (in reality, this would call your Python script)
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            await initDemo();
        }

        // Initialize when page loads
        window.onload = initDemo;
    </script>
</body>
</html>